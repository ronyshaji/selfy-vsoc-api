# SELFY VSOC

This repository holds all source-code and documentation from the SELFY VSOC.

## v.0.2

The current version (v.0.2) supports all interfaces that are required by the SELFY use-cases. The generated logs are shown in the terminal output. There is currently no SIEM solution connected to the VSOC yet. This will be introduced in v.0.3.

## What's in this repository

The `./src/` folder contains all files for the SELFY VSOC API. 

The file `./DOCUMENTATION.md` documents the SELFY VSOC API based on the confirmed endpoints with all tools. There are some deprecated endpoints that are not used by the current version (v.0.2) of the VSOC. They are indicated as *deprecated* on the documentation and in the code.

## How to use (manually) 

You should have installed `python3` and `pip` installed.

First, navigate to the `./src/` folder.
```
cd src/
```

Active the Python virtual environment.
```
source .vsocapi/bin/activate
```

Install all requirements from the `./src/requirements.txt` file.
```
pip install -r requirements.txt
```

Start the VSOC using while using OpenTelemetry.
```
opentelemetry-instrument --traces_exporter console --metrics_exporter console --logs_exporter console --service_name vsoc-api flask run -p 8080
```

The following console output should be shown:
```
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:8080
Press CTRL+C to quit
```

Now, the VSOC is running on localhost (127.0.0.1) and port 8080. You can send requests to the desired endpoint.

For example, the following `curl` request is send by the SOTA environment to the VSOC updating information for an update.
```
curl -H "Content-type: application/json" -X POST -d '{"toolId": 8, "timeStamp": "2023-11-21T06:14:00Z", "vin": "2a910ebe-b39a-4813-9992-373738ab4599", "action": "1", "deviceID": 8, "status": 2, "deviceMetadata": "Such nice metadata"}' http://127.0.0.1:8080/sota/updateInfo
```

Check the terminal output where the VSOC is running. There, you can see logs that are generated by OpenTelemetry.


## Docker

| :exclamation: The Docker Image does currently not contain all features of the VSOC | 
| ---------------------------------------------------------------------------------- |

To run the VSOC docker image you need to have Docker version 24.0.2 or higher installed. The following commands will start and run the docker image:

```
# navigate to the src folder
cd src

# build the docker image and assign the tag "vsoc-api"
docker build --tag vsoc-api .

# check if the docker image was build sucessfully 
docker images 

# the result should show somethink like this:
# REPOSITORY          TAG           IMAGE ID       CREATED         SIZE
# vsoc-api            latest        21bf57473b97   9 minutes ago   148MB

# run the vsoc-api and expose (publish) the host’s port 8000 to the container’s port 5000
# both ports must be exposed to allow interaction with our local client
docker run --publish 8000:5000 vsoc-api

# check if the vsoc-api is running
# this must be done in another terminal if you did not start docker in detached mode with -d
curl localhost:8000 

# you should get the following output (version might be changed)
# {"SELFY VSOC":"by THI","version":"v0.1"}
```

➜  src git:(main) docker run -d --name vsoc-api 27276da04e14 tail -F /dev/null 
➜  src git:(main) docker exec -ti vsoc-api bash

